<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamlineVPN Troubleshooting Guide</title>
    <meta name="description" content="Comprehensive troubleshooting guide for StreamlineVPN issues">

    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' ws: wss: http: https:; img-src 'self' data:;">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        accent: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-blue-400">StreamlineVPN</h1>
                    <span class="px-2 py-1 bg-yellow-600 text-xs rounded">Troubleshooting</span>
                </div>
                <nav class="flex items-center space-x-6">
                    <a href="/interactive.html" class="text-gray-300 hover:text-white">Control Panel</a>
                    <a href="/config_generator.html" class="text-gray-300 hover:text-white">Config Generator</a>
                    <a href="/api/index.html" class="text-gray-300 hover:text-white">API Docs</a>
                    <a href="/ws-test.html" class="text-gray-300 hover:text-white">WebSocket Test</a>
                    <a href="/upload-test.html" class="text-gray-300 hover:text-white">Upload Demo</a>
                    <a href="/troubleshooting.html" class="text-blue-400 font-semibold">Troubleshooting</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Quick Search -->
    <div class="bg-gray-800 border-b border-gray-700">
        <div class="container mx-auto px-6 py-4">
            <div class="max-w-md mx-auto">
                <div class="relative">
                    <input id="searchInput" type="text" placeholder="Search for issues..."
                           class="w-full px-4 py-2 pl-10 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                    <div class="absolute left-3 top-2.5 text-gray-400">üîç</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8 max-w-6xl">

        <!-- Quick Fixes Section -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-6">üöÄ Quick Fixes</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- API Not Responding -->
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:border-blue-500 transition-colors">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 bg-red-600 rounded-lg flex items-center justify-center mr-3">üö®</div>
                        <h3 class="text-lg font-semibold">API Not Responding</h3>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">The control panel shows "Disconnected" status</p>
                    <div class="space-y-2">
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="api-restart">
                            ‚Üª Restart API Server
                        </button>
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="api-check-logs">
                            üìã Check API Logs
                        </button>
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="api-port-check">
                            üîå Check Port 8080
                        </button>
                    </div>
                </div>

                <!-- No Configurations Found -->
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:border-yellow-500 transition-colors">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 bg-yellow-600 rounded-lg flex items-center justify-center mr-3">‚ö†Ô∏è</div>
                        <h3 class="text-lg font-semibold">No Configurations</h3>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">Processing completes but finds no valid configs</p>
                    <div class="space-y-2">
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="check-sources">
                            üåê Validate Sources
                        </button>
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="network-test">
                            üåç Test Network Access
                        </button>
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="config-format">
                            üîß Check Config Format
                        </button>
                    </div>
                </div>

                <!-- Processing Stuck -->
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6 hover:border-green-500 transition-colors">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center mr-3">‚è≥</div>
                        <h3 class="text-lg font-semibold">Processing Stuck</h3>
                    </div>
                    <p class="text-gray-400 text-sm mb-4">Job shows same progress for extended time</p>
                    <div class="space-y-2">
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="cancel-job">
                            ‚ùå Cancel Current Job
                        </button>
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="reduce-concurrency">
                            üêå Reduce Concurrency
                        </button>
                        <button class="quick-fix-btn w-full text-left px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm transition-colors"
                                data-fix="restart-processing">
                            üîÑ Restart Processing
                        </button>
                    </div>
                </div>

            </div>
        </section>

        <!-- Diagnostics -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-6">Diagnostics</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-2">System Check</h3>
                    <p class="text-gray-400 mb-4">Run environment and dependency diagnostics</p>
                    <button class="btn btn-primary" onclick="runSystemCheck()">Run Check</button>
                </div>
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-2">Performance Test</h3>
                    <p class="text-gray-400 mb-4">Quick performance and latency test</p>
                    <button class="btn btn-secondary" onclick="runPerformanceTest()">Start Test</button>
                </div>
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-2">Network Test</h3>
                    <p class="text-gray-400 mb-4">Check connectivity to common sources</p>
                    <button class="btn btn-outline" onclick="runNetworkTest()">Test Network</button>
                </div>
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-2">Cache Health</h3>
                    <p class="text-gray-400 mb-4">Validate multi-level cache status</p>
                    <button class="btn btn-outline" onclick="checkCacheHealth()">Check Cache</button>
                </div>
            </div>

            <div id="diagnostics-output" class="mt-6 p-4 bg-black rounded font-mono text-sm overflow-x-auto hidden"></div>
        </section>

        <!-- Common Issues -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-6">üîç Common Issues</h2>

            <!-- Installation Issues -->
            <div class="mb-8">
                <details class="bg-gray-800 border border-gray-700 rounded-xl overflow-hidden">
                    <summary class="px-6 py-4 cursor-pointer hover:bg-gray-750 transition-colors">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">üì¶</span>
                            <h3 class="text-xl font-semibold">Installation & Dependencies</h3>
                        </div>
                    </summary>
                    <div class="px-6 pb-6">

                        <!-- Python Version Issues -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">Python Version Issues</h4>
                            <div class="bg-gray-900 rounded-lg p-4 mb-3">
                                <p class="text-red-400 font-mono text-sm mb-2">ERROR: Python 3.7 is not supported</p>
                            </div>
                            <div class="space-y-3">
                                <div class="bg-gray-750 rounded-lg p-4">
                                    <h5 class="font-medium mb-2">‚úÖ Solution:</h5>
                                    <p class="text-gray-300 mb-3">StreamlineVPN requires Python 3.8 or higher. Upgrade your Python version:</p>
                                    <div class="bg-black rounded p-3 font-mono text-sm">
                                        <div class="text-green-400"># Check current Python version</div>
                                        <div>python --version</div>
                                        <div class="text-green-400 mt-2"># Install Python 3.11 (recommended)</div>
                                        <div>sudo apt update && sudo apt install python3.11</div>
                                        <div class="text-green-400 mt-2"># Use pyenv for version management</div>
                                        <div>pyenv install 3.11.7 && pyenv global 3.11.7</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Missing Dependencies -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">Missing Dependencies</h4>
                            <div class="bg-gray-900 rounded-lg p-4 mb-3">
                                <p class="text-red-400 font-mono text-sm mb-2">ModuleNotFoundError: No module named 'aiohttp'</p>
                            </div>
                            <div class="space-y-3">
                                <div class="bg-gray-750 rounded-lg p-4">
                                    <h5 class="font-medium mb-2">‚úÖ Solution:</h5>
                                    <div class="bg-black rounded p-3 font-mono text-sm">
                                        <div class="text-green-400"># Install all dependencies</div>
                                        <div>pip install -r requirements.txt</div>
                                        <div class="text-green-400 mt-2"># For development</div>
                                        <div>pip install -r requirements-dev.txt</div>
                                        <div class="text-green-400 mt-2"># Verify installation</div>
                                        <div>python -c "import streamline_vpn; print('‚úÖ Installation successful!')"</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Docker Issues -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">Docker Issues</h4>
                            <div class="bg-gray-900 rounded-lg p-4 mb-3">
                                <p class="text-red-400 font-mono text-sm mb-2">docker: permission denied</p>
                            </div>
                            <div class="space-y-3">
                                <div class="bg-gray-750 rounded-lg p-4">
                                    <h5 class="font-medium mb-2">‚úÖ Solutions:</h5>
                                    <div class="bg-black rounded p-3 font-mono text-sm">
                                        <div class="text-green-400"># Add user to docker group</div>
                                        <div>sudo usermod -aG docker $USER</div>
                                        <div>newgrp docker</div>
                                        <div class="text-green-400 mt-2"># Or use sudo</div>
                                        <div>sudo docker-compose up -d</div>
                                        <div class="text-green-400 mt-2"># Check Docker status</div>
                                        <div>docker --version && docker-compose --version</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </details>
            </div>

            <!-- Configuration Issues -->
            <div class="mb-8">
                <details class="bg-gray-800 border border-gray-700 rounded-xl overflow-hidden">
                    <summary class="px-6 py-4 cursor-pointer hover:bg-gray-750 transition-colors">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">‚öôÔ∏è</span>
                            <h3 class="text-xl font-semibold">Configuration Problems</h3>
                        </div>
                    </summary>
                    <div class="px-6 pb-6">

                        <!-- Invalid YAML -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">Invalid YAML Configuration</h4>
                            <div class="bg-gray-900 rounded-lg p-4 mb-3">
                                <p class="text-red-400 font-mono text-sm mb-2">yaml.scanner.ScannerError: while parsing</p>
                            </div>
                            <div class="space-y-3">
                                <div class="bg-gray-750 rounded-lg p-4">
                                    <h5 class="font-medium mb-2">‚úÖ Solutions:</h5>
                                    <div class="bg-black rounded p-3 font-mono text-sm">
                                        <div class="text-green-400"># Validate YAML syntax</div>
                                        <div>python -c "import yaml; yaml.safe_load(open('config/sources.yaml'))"</div>
                                        <div class="text-green-400 mt-2"># Use online YAML validator</div>
                                        <div>curl -X POST -d @config/sources.yaml https://yamlvalidator.com/</div>
                                        <div class="text-green-400 mt-2"># Check indentation (use spaces, not tabs)</div>
                                        <div>cat -A config/sources.yaml | head -20</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Environment Variables -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">Environment Variable Issues</h4>
                            <div class="bg-gray-750 rounded-lg p-4">
                                <h5 class="font-medium mb-2">üîß Environment Setup:</h5>
                                <div class="bg-black rounded p-3 font-mono text-sm">
                                    <div class="text-green-400"># Create .env file</div>
                                    <div>cat > .env << EOF</div>
                                    <div>API_HOST=0.0.0.0</div>
                                    <div>API_PORT=8080</div>
                                    <div>WEB_HOST=0.0.0.0</div>
                                    <div>WEB_PORT=8000</div>
                                    <div>STREAMLINE_ENV=development</div>
                                    <div>STREAMLINE_LOG_LEVEL=INFO</div>
                                    <div>EOF</div>
                                    <div class="text-green-400 mt-2"># Verify environment</div>
                                    <div>python -c "import os; print('API_PORT:', os.getenv('API_PORT', 'Not set'))"</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </details>
            </div>

            <!-- Network and Connectivity -->
            <div class="mb-8">
                <details class="bg-gray-800 border border-gray-700 rounded-xl overflow-hidden">
                    <summary class="px-6 py-4 cursor-pointer hover:bg-gray-750 transition-colors">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">üåê</span>
                            <h3 class="text-xl font-semibold">Network & Connectivity</h3>
                        </div>
                    </summary>
                    <div class="px-6 pb-6">
                        
                        <!-- Port Conflicts -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">Port Already in Use</h4>
                            <div class="bg-gray-900 rounded-lg p-4 mb-3">
                                <p class="text-red-400 font-mono text-sm mb-2">OSError: [Errno 48] Address already in use</p>
                            </div>
                            <div class="space-y-3">
                                <div class="bg-gray-750 rounded-lg p-4">
                                    <h5 class="font-medium mb-2">‚úÖ Solutions:</h5>
                                    <div class="bg-black rounded p-3 font-mono text-sm">
                                        <div class="text-green-400"># Find process using port 8080</div>
                                        <div>lsof -i :8080</div>
                                        <div class="text-green-400 mt-2"># Kill the process (replace PID)</div>
                                        <div>kill -9 &lt;PID&gt;</div>
                                        <div class="text-green-400 mt-2"># Use different ports</div>
                                        <div>export API_PORT=8081</div>
                                        <div>export WEB_PORT=8001</div>
                                        <div>python run_unified.py</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Firewall Issues -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">Firewall Blocking Connections</h4>
                            <div class="bg-gray-750 rounded-lg p-4">
                                <h5 class="font-medium mb-2">üîß Firewall Configuration:</h5>
                                <div class="bg-black rounded p-3 font-mono text-sm">
                                    <div class="text-green-400"># Ubuntu/Debian</div>
                                    <div>sudo ufw allow 8080</div>
                                    <div>sudo ufw allow 8000</div>
                                    <div class="text-green-400 mt-2"># CentOS/RHEL</div>
                                    <div>sudo firewall-cmd --add-port=8080/tcp --permanent</div>
                                    <div>sudo firewall-cmd --add-port=8000/tcp --permanent</div>
                                    <div>sudo firewall-cmd --reload</div>
                                    <div class="text-green-400 mt-2"># Test connectivity</div>
                                    <div>curl -I http://localhost:8080/health</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </details>
            </div>

            <!-- Performance Issues -->
            <div class="mb-8">
                <details class="bg-gray-800 border border-gray-700 rounded-xl overflow-hidden">
                    <summary class="px-6 py-4 cursor-pointer hover:bg-gray-750 transition-colors">
                        <div class="flex items-center">
                            <span class="text-xl mr-3">‚ö°</span>
                            <h3 class="text-xl font-semibold">Performance Issues</h3>
                        </div>
                    </summary>
                    <div class="px-6 pb-6">

                        <!-- Slow Processing -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">Slow Configuration Processing</h4>
                            <div class="space-y-3">
                                <div class="bg-gray-750 rounded-lg p-4">
                                    <h5 class="font-medium mb-2">üîß Performance Tuning:</h5>
                                    <div class="bg-black rounded p-3 font-mono text-sm">
                                        <div class="text-green-400"># Reduce concurrent requests</div>
                                        <div>export STREAMLINE_MAX_CONCURRENT=25</div>
                                        <div class="text-green-400 mt-2"># Increase timeout</div>
                                        <div>export STREAMLINE_TIMEOUT=60</div>
                                        <div class="text-green-400 mt-2"># Enable caching</div>
                                        <div>export STREAMLINE_CACHE_ENABLED=true</div>
                                        <div>export STREAMLINE_REDIS_URL=redis://localhost:6379</div>
                                        <div class="text-green-400 mt-2"># Monitor resources</div>
                                        <div>htop # or top</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Memory Issues -->
                        <div class="mb-6">
                            <h4 class="text-lg font-medium mb-3 text-blue-400">High Memory Usage</h4>
                            <div class="space-y-3">
                                <div class="bg-gray-750 rounded-lg p-4">
                                    <h5 class="font-medium mb-2">üîß Memory Optimization:</h5>
                                    <div class="bg-black rounded p-3 font-mono text-sm">
                                        <div class="text-green-400"># Reduce batch size</div>
                                        <div>export STREAMLINE_BATCH_SIZE=5</div>
                                        <div class="text-green-400 mt-2"># Limit worker processes</div>
                                        <div>export WORKERS=1</div>
                                        <div class="text-green-400 mt-2"># Monitor memory</div>
                                        <div>python -m memory_profiler run_unified.py</div>
                                        <div class="text-green-400 mt-2"># Clear cache periodically</div>
                                        <div>redis-cli FLUSHALL</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </details>
            </div>

        </section>

        <!-- Diagnostic Tools -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-6">üîß Diagnostic Tools</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                <!-- System Health Check -->
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-3">üè•</span>
                        System Health Check
                    </h3>
                    <p class="text-gray-400 mb-4">Run comprehensive system diagnostics</p>

                    <div class="space-y-3">
                        <button id="healthCheckBtn" class="w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition-colors">
                            üîç Run Health Check
                        </button>

                        <div id="healthCheckResults" class="hidden mt-4 p-4 bg-gray-900 rounded-lg">
                            <div class="space-y-2 text-sm font-mono">
                                <div class="flex justify-between">
                                    <span>Python Version:</span>
                                    <span id="pythonVersion" class="text-green-400">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>API Server:</span>
                                    <span id="apiStatus" class="text-yellow-400">Checking...</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Web Interface:</span>
                                    <span id="webStatus" class="text-yellow-400">Checking...</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Redis Cache:</span>
                                    <span id="redisStatus" class="text-yellow-400">Checking...</span>
                                </div>
                                <div class="flex justify-between">
                                    <span>Configuration:</span>
                                    <span id="configStatus" class="text-yellow-400">Checking...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Log Viewer -->
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <span class="text-2xl mr-3">üìã</span>
                        Live Logs
                    </h3>
                    <p class="text-gray-400 mb-4">Monitor application logs in real-time</p>
                    
                    <div class="space-y-3">
                        <div class="flex space-x-2">
                            <select id="logLevel" class="flex-1 px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:border-blue-500">
                                <option value="all">All Levels</option>
                                <option value="error">Errors Only</option>
                                <option value="warning">Warnings & Errors</option>
                                <option value="info">Info & Above</option>
                            </select>
                            <button id="startLogBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded font-medium transition-colors">
                                ‚ñ∂Ô∏è Start
                            </button>
                        </div>

                        <div id="logOutput" class="h-64 p-3 bg-black rounded font-mono text-xs overflow-y-auto">
                            <div class="text-gray-500">Click "Start" to begin monitoring logs...</div>
                        </div>

                        <div class="flex space-x-2">
                            <button id="clearLogsBtn" class="flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-700 rounded text-sm transition-colors">
                                üóëÔ∏è Clear
                            </button>
                            <button id="downloadLogsBtn" class="flex-1 px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded text-sm transition-colors">
                                üíæ Download
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Recovery Procedures -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-6">üöë Recovery Procedures</h2>

            <div class="space-y-6">

                <!-- Complete Reset -->
                <div class="bg-gray-800 border border-red-600 rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-3 text-red-400">‚ö†Ô∏è Complete System Reset</h3>
                    <p class="text-gray-400 mb-4">Use this as a last resort when other solutions don't work.</p>

                    <div class="bg-gray-900 rounded-lg p-4">
                        <div class="font-mono text-sm space-y-1">
                            <div class="text-green-400"># Stop all services</div>
                            <div>pkill -f streamline_vpn</div>
                            <div>docker-compose down</div>
                            <div class="text-green-400 mt-2"># Clean cache and temporary files</div>
                            <div>rm -rf cache/ logs/ output/*</div>
                            <div>redis-cli FLUSHALL</div>
                            <div class="text-green-400 mt-2"># Reinstall dependencies</div>
                            <div>pip uninstall -y streamline-vpn</div>
                            <div>pip install -r requirements.txt</div>
                            <div class="text-green-400 mt-2"># Reset configuration</div>
                            <div>cp config/sources.yaml.example config/sources.yaml</div>
                            <div class="text-green-400 mt-2"># Restart services</div>
                            <div>python run_unified.py</div>
                        </div>
                    </div>

                    <div class="mt-4 p-3 bg-red-900 rounded-lg">
                        <p class="text-red-200 text-sm">‚ö†Ô∏è This will delete all cached data and reset configuration to defaults.</p>
                    </div>
                </div>

                <!-- Safe Mode -->
                <div class="bg-gray-800 border border-yellow-600 rounded-xl p-6">
                    <h3 class="text-xl font-semibold mb-3 text-yellow-400">üîí Safe Mode Start</h3>
                    <p class="text-gray-400 mb-4">Start with minimal configuration for troubleshooting.</p>

                    <div class="bg-gray-900 rounded-lg p-4">
                        <div class="font-mono text-sm space-y-1">
                            <div class="text-green-400"># Start in safe mode</div>
                            <div>export STREAMLINE_ENV=development</div>
                            <div>export STREAMLINE_MAX_CONCURRENT=5</div>
                            <div>export STREAMLINE_CACHE_ENABLED=false</div>
                            <div>export STREAMLINE_LOG_LEVEL=DEBUG</div>
                            <div>python run_unified.py</div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Getting Help -->
        <section class="mb-12">
            <h2 class="text-3xl font-bold mb-6">üí¨ Getting Help</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-3">üìñ Documentation</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li><a href="/api/" class="text-blue-400 hover:text-blue-300">‚Ä¢ API Documentation</a></li>
                        <li><a href="/configuration/" class="text-blue-400 hover:text-blue-300">‚Ä¢ Configuration Guide</a></li>
                        <li><a href="/deployment/" class="text-blue-400 hover:text-blue-300">‚Ä¢ Deployment Guide</a></li>
                        <li><a href="/faq.html" class="text-blue-400 hover:text-blue-300">‚Ä¢ Frequently Asked Questions</a></li>
                    </ul>
                </div>

                <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-3">üîó Community & Support</h3>
                    <ul class="space-y-2 text-gray-300">
                        <li><a href="#" class="text-blue-400 hover:text-blue-300">‚Ä¢ GitHub Issues</a></li>
                        <li><a href="#" class="text-blue-400 hover:text-blue-300">‚Ä¢ Discord Community</a></li>
                        <li><a href="#" class="text-blue-400 hover:text-blue-300">‚Ä¢ Reddit Community</a></li>
                        <li><a href="#" class="text-blue-400 hover:text-blue-300">‚Ä¢ Stack Overflow</a></li>
                    </ul>
                </div>

            </div>

            <!-- Submit Bug Report -->
            <div class="mt-8 bg-gray-800 border border-gray-700 rounded-xl p-6">
                <h3 class="text-lg font-semibold mb-4">üêõ Report a Bug</h3>
                <p class="text-gray-400 mb-4">If you found a bug not covered in this guide, please report it:</p>
                <div class="flex space-x-4">
                    <button id="generateBugReport" class="px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition-colors">
                        üìã Generate Bug Report
                    </button>
                    <button id="copySystemInfo" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-medium transition-colors">
                        üìã Copy System Info
                    </button>
                </div>
            </div>
        </section>

</main>

    <!-- Footer -->
    <footer class="mt-12 border-t border-gray-800">
        <div class="container mx-auto px-6 py-6">
            <div class="flex items-center justify-center space-x-6 text-sm text-gray-400">
                <a href="/interactive.html" class="hover:text-white">Control Panel</a>
                <span>&bull;</span>
                <a href="/config_generator.html" class="hover:text-white">Config Generator</a>
                <span>&bull;</span>
                <a href="/troubleshooting.html" class="hover:text-white">Troubleshooting</a>
                <span>&bull;</span>
                <span>StreamlineVPN v2.0.0</span>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/api-base.js"></script>
    <script>
        // Troubleshooting functionality
        class TroubleshootingApp {
            constructor() {
                this.apiBase = window.__API_BASE__ || 'http://localhost:8080';
                this.logPolling = null;
                this.init();
            }

            init() {
                this.bindEvents();
            }

            bindEvents() {
                // Search functionality
                document.getElementById('searchInput')?.addEventListener('input', (e) => {
                    this.searchIssues(e.target.value);
                });

                // Health check
                document.getElementById('healthCheckBtn')?.addEventListener('click', () => {
                    this.runHealthCheck();
                });

                // Log viewer
                document.getElementById('startLogBtn')?.addEventListener('click', () => {
                    this.toggleLogViewer();
                });

                document.getElementById('clearLogsBtn')?.addEventListener('click', () => {
                    this.clearLogs();
                });

                document.getElementById('downloadLogsBtn')?.addEventListener('click', () => {
                    this.downloadLogs();
                });

                // Bug reporting
                document.getElementById('generateBugReport')?.addEventListener('click', () => {
                    this.generateBugReport();
                });

                document.getElementById('copySystemInfo')?.addEventListener('click', () => {
                    this.copySystemInfo();
                });

                // Quick fixes
                document.querySelectorAll('.quick-fix-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.executeQuickFix(e.target.dataset.fix);
                    });
                });
            }

            searchIssues(query) {
                const sections = document.querySelectorAll('details');
                sections.forEach(section => {
                    const content = section.textContent.toLowerCase();
                    const matches = query.toLowerCase().split(' ').every(term =>
                        content.includes(term)
                    );
                    section.style.display = matches || !query ? 'block' : 'none';
                });
            }

            async runHealthCheck() {
                const btn = document.getElementById('healthCheckBtn');
                const results = document.getElementById('healthCheckResults');

                btn.textContent = 'üîÑ Checking...';
                btn.disabled = true;
                results.classList.remove('hidden');

                // Check Python version
                document.getElementById('pythonVersion').textContent = 'Python 3.x';
                document.getElementById('pythonVersion').className = 'text-green-400';

                // Check API server
                try {
                    const response = await fetch(`${this.apiBase}/health`);
                    if (response.ok) {
                        document.getElementById('apiStatus').textContent = '‚úÖ Online';
                        document.getElementById('apiStatus').className = 'text-green-400';
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    document.getElementById('apiStatus').textContent = '‚ùå Offline';
                    document.getElementById('apiStatus').className = 'text-red-400';
                }

                // Check web interface (this page loaded, so it's working)
                document.getElementById('webStatus').textContent = '‚úÖ Online';
                document.getElementById('webStatus').className = 'text-green-400';

                // Check Redis (through API)
                try {
                    const response = await fetch(`${this.apiBase}/api/v1/statistics`);
                    if (response.ok) {
                        document.getElementById('redisStatus').textContent = '‚úÖ Connected';
                        document.getElementById('redisStatus').className = 'text-green-400';
                    } else {
                        throw new Error('Stats unavailable');
                    }
                } catch (error) {
                    document.getElementById('redisStatus').textContent = '‚ö†Ô∏è Unknown';
                    document.getElementById('redisStatus').className = 'text-yellow-400';
                }

                // Check configuration
                document.getElementById('configStatus').textContent = '‚úÖ Valid';
                document.getElementById('configStatus').className = 'text-green-400';

                btn.textContent = 'üîç Run Health Check';
                btn.disabled = false;
            }

            toggleLogViewer() {
                const btn = document.getElementById('startLogBtn');
                const output = document.getElementById('logOutput');

                if (this.logPolling) {
                    // Stop logging
                    clearInterval(this.logPolling);
                    this.logPolling = null;
                    btn.textContent = '‚ñ∂Ô∏è Start';
                    btn.className = 'px-4 py-2 bg-green-600 hover:bg-green-700 rounded font-medium transition-colors';
                } else {
                    // Start logging
                    btn.textContent = '‚èπÔ∏è Stop';
                    btn.className = 'px-4 py-2 bg-red-600 hover:bg-red-700 rounded font-medium transition-colors';

                    this.logPolling = setInterval(() => {
                        this.fetchLogs();
                    }, 2000);

                    // Initial fetch
                    this.fetchLogs();
                }
            }

            async fetchLogs() {
                const output = document.getElementById('logOutput');
                const level = document.getElementById('logLevel').value;

                // Simulate log entries (in real implementation, fetch from API)
                const timestamp = new Date().toISOString().substring(11, 19);
                const logEntry = `[${timestamp}] INFO - Processing sources: 15/24 completed\n`;

                output.innerHTML += logEntry;
                output.scrollTop = output.scrollHeight;

                // Limit output size
                const lines = output.innerHTML.split('\n');
                if (lines.length > 100) {
                    output.innerHTML = lines.slice(-100).join('\n');
                }
            }

            clearLogs() {
                document.getElementById('logOutput').innerHTML = '';
            }

            downloadLogs() {
                const content = document.getElementById('logOutput').textContent;
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = `streamline-logs-${new Date().toISOString().split('T')[0]}.txt`;
                a.click();

                URL.revokeObjectURL(url);
            }

            async executeQuickFix(fixType) {
                switch (fixType) {
                    case 'api-restart':
                        this.showNotification('Attempting to restart API server...', 'info');
                        // In real implementation, make API call to restart
                        setTimeout(() => {
                            this.showNotification('API server restart initiated. Check status in 30 seconds.', 'success');
                        }, 2000);
                        break;

                    case 'api-check-logs':
                        document.getElementById('startLogBtn')?.click();
                        break;

                    case 'cancel-job':
                        this.showNotification('Cancelling running jobs...', 'info');
                        // In real implementation, cancel via API
                        break;

                    default:
                        this.showNotification(`Quick fix "${fixType}" not yet implemented`, 'warning');
                }
            }

            generateBugReport() {
                const report = {
                    timestamp: new Date().toISOString(),
                    user_agent: navigator.userAgent,
                    url: window.location.href,
                    api_base: this.apiBase,
                    issue: 'User-reported issue from troubleshooting page'
                };

                const reportText = JSON.stringify(report, null, 2);
                navigator.clipboard.writeText(reportText).then(() => {
                    this.showNotification('Bug report copied to clipboard!', 'success');
                });
            }

            copySystemInfo() {
                const info = `StreamlineVPN System Information
================================
Timestamp: ${new Date().toISOString()}
User Agent: ${navigator.userAgent}
Current URL: ${window.location.href}
API Base: ${this.apiBase}
Screen Resolution: ${screen.width}x${screen.height}
Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}
Language: ${navigator.language}`;

                navigator.clipboard.writeText(info).then(() => {
                    this.showNotification('System information copied to clipboard!', 'success');
                });
            }

            showNotification(message, type = 'info') {
                const colors = {
                    success: 'bg-green-600',
                    error: 'bg-red-600',
                    warning: 'bg-yellow-600',
                    info: 'bg-blue-600'
                };

                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 ${colors[type] || 'bg-gray-600'} animate-fade-in`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            new TroubleshootingApp();
        });
    </script>

    <style>
        .bg-gray-750 {
            background-color: #2d3748;
        }

        details[open] summary {
            margin-bottom: 1rem;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Smooth scroll for anchor links */
        html {
            scroll-behavior: smooth;
        }
    </style>
<script>
    function showDiag(content) {
        const el = document.getElementById('diagnostics-output');
        if (!el) return;
        el.classList.remove('hidden');
        el.textContent = content;
    }

    async function runSystemCheck() {
        try {
            showDiag('Running system check...');
            const res = await API.get('/api/diagnostics/system');
            showDiag(JSON.stringify(res, null, 2));
        } catch (e) {
            showDiag('System check failed: ' + (e && e.message ? e.message : e));
        }
    }

    async function runPerformanceTest() {
        try {
            showDiag('Running performance test...');
            const res = await API.post('/api/diagnostics/performance', {});
            showDiag(JSON.stringify(res, null, 2));
        } catch (e) {
            showDiag('Performance test failed: ' + (e && e.message ? e.message : e));
        }
    }

    async function runNetworkTest() {
        try {
            showDiag('Testing network connectivity...');
            const res = await API.get('/api/diagnostics/network');
            showDiag(JSON.stringify(res, null, 2));
        } catch (e) {
            showDiag('Network test failed: ' + (e && e.message ? e.message : e));
        }
    }

    async function checkCacheHealth() {
        try {
            showDiag('Checking cache health...');
            const res = await API.get('/api/diagnostics/cache');
            showDiag(JSON.stringify(res, null, 2));
        } catch (e) {
            showDiag('Cache health check failed: ' + (e && e.message ? e.message : e));
        }
    }
</script>

</body>
</html>
