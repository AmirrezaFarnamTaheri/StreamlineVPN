<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamlineVPN Configuration Generator</title>
    <meta name="description" content="Generate VPN configurations for various protocols">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' ws: wss: http: https:; img-src 'self' data: https://api.qrserver.com;">
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#10b981',
                        accent: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-900 text-white min-h-screen">
    <header class="bg-gray-800 border-b border-gray-700">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-blue-400">StreamlineVPN</h1>
                    <span class="px-2 py-1 bg-green-600 text-xs rounded">Configuration Generator</span>
                </div>
                <nav class="flex items-center space-x-6">
                    <a href="/interactive.html" class="text-gray-300 hover:text-white">Control Panel</a>
                    <a href="/config_generator.html" class="text-blue-400 font-semibold">Config Generator</a>
                    <a href="/troubleshooting.html" class="text-gray-300 hover:text-white">Help</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8 max-w-4xl">
        <div class="mb-8">
            <div class="flex items-center justify-center space-x-4 mb-6">
                <div class="flex items-center">
                    <div id="step1Badge" class="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-sm font-bold">1</div>
                    <span class="ml-2 text-sm font-medium">Protocol</span>
                </div>
                <div id="connector1" class="w-12 h-0.5 bg-gray-600"></div>
                <div class="flex items-center">
                    <div id="step2Badge" class="w-8 h-8 bg-gray-600 text-gray-300 rounded-full flex items-center justify-center text-sm font-bold">2</div>
                    <span class="ml-2 text-sm font-medium text-gray-400">Parameters</span>
                </div>
                <div id="connector2" class="w-12 h-0.5 bg-gray-600"></div>
                <div class="flex items-center">
                    <div id="step3Badge" class="w-8 h-8 bg-gray-600 text-gray-300 rounded-full flex items-center justify-center text-sm font-bold">3</div>
                    <span class="ml-2 text-sm font-medium text-gray-400">Output</span>
                </div>
            </div>
        </div>

        <!-- Step 1 -->
        <section id="step1" class="bg-gray-800 rounded-xl p-8 border border-gray-700">
            <h2 class="text-2xl font-bold mb-6 text-center">Select VPN Protocol</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <button class="protocol-btn" data-protocol="vmess">
                    <div class="text-2xl mb-2">üöÄ</div>
                    <div class="font-semibold">VMess</div>
                    <div class="text-sm text-gray-400 mt-2">V2Ray protocol</div>
                </button>
                <button class="protocol-btn" data-protocol="vless">
                    <div class="text-2xl mb-2">‚ö°</div>
                    <div class="font-semibold">VLESS</div>
                    <div class="text-sm text-gray-400 mt-2">Lightweight V2Ray</div>
                </button>
                <button class="protocol-btn" data-protocol="trojan">
                    <div class="text-2xl mb-2">üõ°Ô∏è</div>
                    <div class="font-semibold">Trojan</div>
                    <div class="text-sm text-gray-400 mt-2">TLS-based protocol</div>
                </button>
                <button class="protocol-btn" data-protocol="shadowsocks">
                    <div class="text-2xl mb-2">üîí</div>
                    <div class="font-semibold">Shadowsocks</div>
                    <div class="text-sm text-gray-400 mt-2">SOCKS5-based proxy</div>
                </button>
                <button class="protocol-btn" data-protocol="hysteria">
                    <div class="text-2xl mb-2">üå™Ô∏è</div>
                    <div class="font-semibold">Hysteria</div>
                    <div class="text-sm text-gray-400 mt-2">QUIC-based protocol</div>
                </button>
                <button class="protocol-btn" data-protocol="tuic">
                    <div class="text-2xl mb-2">üîÑ</div>
                    <div class="font-semibold">TUIC</div>
                    <div class="text-sm text-gray-400 mt-2">UDP-based protocol</div>
                </button>
            </div>
        </section>

        <!-- Step 2 -->
        <section id="step2" class="bg-gray-800 rounded-xl p-8 border border-gray-700 hidden">
            <h2 class="text-2xl font-bold mb-6 text-center">Configure Parameters</h2>
            <div class="grid md:grid-cols-2 gap-6 mb-6">
                <div>
                    <label class="block text-sm font-medium mb-2">Server Address</label>
                    <input id="server" type="text" placeholder="example.com" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none" />
                    <p class="text-xs text-gray-400 mt-1">Server hostname or IP address</p>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Port</label>
                    <input id="port" type="number" placeholder="443" min="1" max="65535" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none" />
                    <p class="text-xs text-gray-400 mt-1">Port number (1-65535)</p>
                </div>
            </div>

            <!-- VMess Parameters -->
            <div id="vmess-params" class="protocol-params hidden">
                <h3 class="text-lg font-semibold mb-4 text-blue-400">VMess Configuration</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">User ID (UUID)</label>
                        <div class="flex">
                            <input id="vmess-uuid" type="text" placeholder="Generate or enter UUID" class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-l-lg focus:border-blue-500 focus:outline-none" />
                            <button id="generate-uuid" type="button" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 border border-blue-600 rounded-r-lg transition-colors">Generate</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Alter ID</label>
                        <input id="vmess-alterId" type="number" value="0" min="0" max="255" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Security</label>
                        <select id="vmess-security" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="auto">auto</option>
                            <option value="aes-128-gcm">aes-128-gcm</option>
                            <option value="chacha20-poly1305">chacha20-poly1305</option>
                            <option value="none">none</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Network</label>
                        <select id="vmess-network" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="tcp">TCP</option>
                            <option value="ws">WebSocket</option>
                            <option value="grpc">gRPC</option>
                            <option value="h2">HTTP/2</option>
                        </select>
                    </div>
                </div>
                <div id="ws-settings" class="mt-4 p-4 bg-gray-700 rounded-lg hidden">
                    <h4 class="font-medium mb-3">WebSocket Settings</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Path</label>
                            <input id="ws-path" type="text" placeholder="/path" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Host</label>
                            <input id="ws-host" type="text" placeholder="example.com" class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none" />
                        </div>
                    </div>
                </div>
            </div>

            <!-- VLESS Parameters -->
            <div id="vless-params" class="protocol-params hidden">
                <h3 class="text-lg font-semibold mb-4 text-green-400">VLESS Configuration</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">User ID (UUID)</label>
                        <div class="flex">
                            <input id="vless-uuid" type="text" placeholder="Generate or enter UUID" class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-l-lg focus:border-blue-500 focus:outline-none" />
                            <button id="generate-vless-uuid" type="button" class="px-4 py-2 bg-green-600 hover:bg-green-700 border border-green-600 rounded-r-lg transition-colors">Generate</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Encryption</label>
                        <select id="vless-encryption" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="none">none</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Flow</label>
                        <select id="vless-flow" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="">None</option>
                            <option value="xtls-rprx-direct">xtls-rprx-direct</option>
                            <option value="xtls-rprx-splice">xtls-rprx-splice</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Network</label>
                        <select id="vless-network" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="tcp">TCP</option>
                            <option value="ws">WebSocket</option>
                            <option value="grpc">gRPC</option>
                            <option value="h2">HTTP/2</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Trojan Parameters -->
            <div id="trojan-params" class="protocol-params hidden">
                <h3 class="text-lg font-semibold mb-4 text-yellow-400">Trojan Configuration</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Password</label>
                        <div class="flex">
                            <input id="trojan-password" type="text" placeholder="Enter or generate password" class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-l-lg focus:border-blue-500 focus:outline-none" />
                            <button id="generate-trojan-password" type="button" class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 border border-yellow-600 rounded-r-lg transition-colors">Generate</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">SNI</label>
                        <input id="trojan-sni" type="text" placeholder="example.com" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Network</label>
                        <select id="trojan-network" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="tcp">TCP</option>
                            <option value="ws">WebSocket</option>
                            <option value="grpc">gRPC</option>
                        </select>
                    </div>
                    <div>
                        <label class="flex items-center space-x-2"><input id="trojan-allowInsecure" type="checkbox" class="w-4 h-4 text-yellow-600" /><span class="text-sm">Allow Insecure</span></label>
                    </div>
                </div>
            </div>

            <!-- Shadowsocks Parameters -->
            <div id="shadowsocks-params" class="protocol-params hidden">
                <h3 class="text-lg font-semibold mb-4 text-purple-400">Shadowsocks Configuration</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Password</label>
                        <div class="flex">
                            <input id="ss-password" type="text" placeholder="Enter or generate password" class="flex-1 px-4 py-2 bg-gray-700 border border-gray-600 rounded-l-lg focus:border-blue-500 focus:outline-none" />
                            <button id="generate-ss-password" type="button" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 border border-purple-600 rounded-r-lg transition-colors">Generate</button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Method</label>
                        <select id="ss-method" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-blue-500 focus:outline-none">
                            <option value="aes-256-gcm">aes-256-gcm</option>
                            <option value="aes-128-gcm">aes-128-gcm</option>
                            <option value="chacha20-ietf-poly1305">chacha20-ietf-poly1305</option>
                            <option value="2022-blake3-aes-256-gcm">2022-blake3-aes-256-gcm</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="flex justify-between mt-8">
                <button id="prevStep" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors">‚Üê Previous</button>
                <button id="nextStep" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">Next ‚Üí</button>
            </div>
        </section>

        <!-- Step 3 -->
        <section id="step3" class="bg-gray-800 rounded-xl p-8 border border-gray-700 hidden">
            <h2 class="text-2xl font-bold mb-6 text-center">Generated Configuration</h2>
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2">Output Format</label>
                <div class="flex flex-wrap gap-2">
                    <button class="format-btn" data-format="url">URL</button>
                    <button class="format-btn" data-format="json">JSON</button>
                    <button class="format-btn" data-format="clash">Clash</button>
                    <button class="format-btn" data-format="singbox">Sing-Box</button>
                </div>
            </div>
            <div class="mb-6">
                <div class="flex items-center justify-between mb-2">
                    <label class="text-sm font-medium">Generated Configuration</label>
                    <div class="flex space-x-2">
                        <button id="copyConfig" class="px-3 py-1 bg-green-600 hover:bg-green-700 text-sm rounded transition-colors">Copy</button>
                        <button id="downloadConfig" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-sm rounded transition-colors">Download</button>
                        <button id="testConfig" class="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-sm rounded transition-colors">Test</button>
                    </div>
                </div>
                <textarea id="configOutput" readonly class="w-full h-64 px-4 py-3 bg-gray-900 border border-gray-600 rounded-lg font-mono text-sm focus:outline-none" placeholder="Configuration will appear here..."></textarea>
            </div>
            <div class="mb-6">
                <label class="text-sm font-medium mb-2 block">QR Code</label>
                <div class="flex justify-center p-6 bg-white rounded-lg">
                    <div id="qrcode" class="w-48 h-48 bg-gray-100 rounded-lg flex items-center justify-center text-gray-500">QR Code will appear here</div>
                </div>
            </div>
            <div class="flex justify-between mt-8">
                <button id="prevStep3" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors">‚Üê Previous</button>
                <button id="restartWizard" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors">Start Over</button>
            </div>
        </section>
    </main>

    <footer class="mt-12 border-t border-gray-800">
        <div class="container mx-auto px-6 py-6">
            <div class="flex items-center justify-center space-x-6 text-sm text-gray-400">
                <a href="/interactive.html" class="hover:text-white">Control Panel</a>
                <span>&bull;</span>
                <a href="/config_generator.html" class="hover:text-white">Config Generator</a>
                <span>&bull;</span>
                <a href="/troubleshooting.html" class="hover:text-white">Troubleshooting</a>
                <span>&bull;</span>
                <span>StreamlineVPN v2.0.0</span>
            </div>
        </div>
    </footer>

    <script src="/api-base.js"></script>
    <script src="/assets/js/main.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function(){
        let currentStep = 1;
        let selectedProtocol = null;
        const steps = {1:document.getElementById('step1'),2:document.getElementById('step2'),3:document.getElementById('step3')};
        const badges = [null, document.getElementById('step1Badge'), document.getElementById('step2Badge'), document.getElementById('step3Badge')];
        const connectors = [null, document.getElementById('connector1'), document.getElementById('connector2')];

        function updateProgress(){
            for(let i=1;i<=3;i++){
                if(badges[i]){
                    badges[i].className = 'w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ' + (i<=currentStep ? 'bg-blue-600 text-white':'bg-gray-600 text-gray-300');
                }
                if(connectors[i]){
                    connectors[i].className = 'w-12 h-0.5 ' + (i<currentStep ? 'bg-blue-600':'bg-gray-600');
                }
            }
        }
        function showStep(n){
            currentStep = n;
            Object.values(steps).forEach(s=>s.classList.add('hidden'));
            steps[n].classList.remove('hidden');
            updateProgress();
        }
        function showParams(proto){
            document.querySelectorAll('.protocol-params').forEach(p=>p.classList.add('hidden'));
            const el=document.getElementById(`${proto}-params`);
            if(el) el.classList.remove('hidden');
        }
        document.querySelectorAll('.protocol-btn').forEach(btn=>{
            btn.addEventListener('click',()=>{
                selectedProtocol = btn.dataset.protocol;
                document.querySelectorAll('.protocol-btn').forEach(b=>b.classList.remove('bg-blue-600'));
                btn.classList.add('bg-blue-600');
                showParams(selectedProtocol);
                showStep(2);
            });
        });

        document.getElementById('vmess-network').addEventListener('change', e=>{
            document.getElementById('ws-settings').classList.toggle('hidden', e.target.value !== 'ws');
        });

        document.getElementById('prevStep').addEventListener('click', ()=>showStep(1));
        document.getElementById('nextStep').addEventListener('click', ()=>{ generateConfig(); showStep(3); });
        document.getElementById('prevStep3').addEventListener('click', ()=>showStep(2));
        document.getElementById('restartWizard').addEventListener('click', ()=>{ selectedProtocol=null; document.getElementById('configOutput').value=''; document.getElementById('qrcode').innerHTML='QR Code will appear here'; showStep(1); });

        document.querySelectorAll('.format-btn').forEach(btn=>{
            btn.addEventListener('click',()=>{
                document.querySelectorAll('.format-btn').forEach(b=>b.classList.remove('bg-blue-600','text-white'));
                btn.classList.add('bg-blue-600','text-white');
                renderOutput(btn.dataset.format);
            });
        });

        document.getElementById('copyConfig').addEventListener('click', async ()=>{
            const txt=document.getElementById('configOutput').value; if(!txt) return;
            try{ await navigator.clipboard.writeText(txt); alert('Copied to clipboard'); }catch(_){ alert('Copy failed'); }
        });
        document.getElementById('downloadConfig').addEventListener('click', ()=>{
            const txt=document.getElementById('configOutput').value; if(!txt) return;
            const blob=new Blob([txt],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='config.txt'; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),1000);
        });
        document.getElementById('testConfig').addEventListener('click', async ()=>{
            try{ const res=await window.StreamlineVPN.API.healthCheck(); alert(res.success ? 'API reachable' : 'API error'); }catch(e){ alert('Test failed'); }
        });

        function generateUUID(){return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){const r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});}
        document.getElementById('generate-uuid').addEventListener('click',()=>{document.getElementById('vmess-uuid').value=generateUUID();});
        document.getElementById('generate-vless-uuid').addEventListener('click',()=>{document.getElementById('vless-uuid').value=generateUUID();});
        document.getElementById('generate-trojan-password').addEventListener('click',()=>{document.getElementById('trojan-password').value=generateUUID().replace(/-/g,'');});
        document.getElementById('generate-ss-password').addEventListener('click',()=>{document.getElementById('ss-password').value=generateUUID().replace(/-/g,'');});

        function gather(){
            const server=document.getElementById('server').value.trim();
            const port=parseInt(document.getElementById('port').value.trim(),10)||0;
            const cfg={protocol:selectedProtocol, server, port};
            if(selectedProtocol==='vmess'){
                cfg.uuid=document.getElementById('vmess-uuid').value.trim();
                cfg.alterId=parseInt(document.getElementById('vmess-alterId').value,10)||0;
                cfg.security=document.getElementById('vmess-security').value;
                cfg.network=document.getElementById('vmess-network').value;
                if(cfg.network==='ws') cfg.ws={path:document.getElementById('ws-path').value, host:document.getElementById('ws-host').value};
            } else if(selectedProtocol==='vless'){
                cfg.uuid=document.getElementById('vless-uuid').value.trim();
                cfg.encryption=document.getElementById('vless-encryption').value;
                cfg.flow=document.getElementById('vless-flow').value;
                cfg.network=document.getElementById('vless-network').value;
            } else if(selectedProtocol==='trojan'){
                cfg.password=document.getElementById('trojan-password').value.trim();
                cfg.sni=document.getElementById('trojan-sni').value.trim();
                cfg.network=document.getElementById('trojan-network').value;
                cfg.allowInsecure=document.getElementById('trojan-allowInsecure').checked;
            } else if(selectedProtocol==='shadowsocks'){
                cfg.password=document.getElementById('ss-password').value.trim();
                cfg.method=document.getElementById('ss-method').value;
            }
            return cfg;
        }

        function renderOutput(fmt){
            const cfg=gather();
            let out='';
            if(fmt==='json'){
                out=JSON.stringify(cfg,null,2);
            } else if(fmt==='clash'){
                out=['proxies:',`  - name: "${cfg.server}"`,`    type: ${cfg.protocol}`,`    server: ${cfg.server}`,`    port: ${cfg.port}`].join('\n');
            } else if(fmt==='singbox'){
                out=JSON.stringify({outbounds:[{type:cfg.protocol,tag:'proxy',server:cfg.server,server_port:cfg.port}]},null,2);
            } else {
                out=`${cfg.protocol}://${btoa(JSON.stringify(cfg))}`;
                updateQRCode(out);
            }
            document.getElementById('configOutput').value=out;
        }

        function updateQRCode(text){
            const qr=document.getElementById('qrcode');
            qr.innerHTML='';
            const img=document.createElement('img');
            img.src=`https://api.qrserver.com/v1/create-qr-code/?size=192x192&data=${encodeURIComponent(text)}`;
            img.alt='QR Code';
            qr.appendChild(img);
        }

        function generateConfig(){
            document.querySelectorAll('.format-btn').forEach(b=>b.classList.remove('bg-blue-600','text-white'));
            const btn=document.querySelector('.format-btn[data-format="url"]');
            if(btn) btn.classList.add('bg-blue-600','text-white');
            renderOutput('url');
        }

        showStep(1);
    });
    </script>
</body>
</html>
