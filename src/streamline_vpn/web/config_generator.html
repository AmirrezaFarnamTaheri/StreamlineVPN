<!DOCTYPE html>
<html>
<head>
    <title>StreamlineVPN Config Generator</title>
    <link rel="stylesheet" href="/assets/site.css" />
</head>
<body class="config-generator">
    <div class="container">
        <h1>ðŸš€ StreamlineVPN Config Generator</h1>
        <p>Generate and download VPN configurations in multiple formats.</p>

        <div>
            <button class="button" onclick="loadConfigs()">Load Configurations</button>
            <button class="button" onclick="generateConfigs()">Generate New</button>
        </div>

        <div class="config-list" id="configList">
            <p>Click "Load Configurations" to see available configurations.</p>
        </div>

        <div>
            <h3>Download Formats:</h3>
            <button class="button" onclick="downloadConfigs('json')">JSON</button>
            <button class="button" onclick="downloadConfigs('clash')">Clash</button>
            <button class="button" onclick="downloadConfigs('singbox')">SingBox</button>
            <button class="button" onclick="downloadConfigs('raw')">Raw</button>
        </div>
    </div>

    <script>
        async function loadConfigs() {
            try {
                const response = await fetch('/api/configs');
                const data = await response.json();

                const configList = document.getElementById('configList');
                const configsHTML = data.configurations.map(
                    config => `
                    <div class="config-item">
                        <strong>${config.protocol}</strong>
                        - ${config.server}:${config.port}
                        <br><small>Quality: ${
                            (config.quality_score != null && !isNaN(config.quality_score))
                              ? Number(config.quality_score).toFixed(2)
                              : 'N/A'
                        }</small>
                        <br><small>Network: ${
                            config.network ?? 'N/A'
                        }</small>
                    </div>`
                ).join('');

                configList.innerHTML = `
                    <h3>Available Configurations (${
                        data.count
                    })</h3>
                    ${configsHTML}
                `;
            } catch (error) {
                alert(
                    'Error loading configurations: ' + error.message
                );
            }
        }

        async function generateConfigs() {
            try {
                const response = await fetch('/api/generate', { method: 'POST' });
                const data = await response.json();
                alert(data.message);
                loadConfigs();
            } catch (error) {
                const errorMsg =
                    "Error generating configurations: " +
                    error.message;
                alert(errorMsg);
            }
        }

        function downloadConfigs(format) {
            window.open(
                `/api/download/${format}`, '_blank'
            );
        }
    </script>
</body>
</html>
